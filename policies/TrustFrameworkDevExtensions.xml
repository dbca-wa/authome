<?xml version="1.0" encoding="utf-8"?>
<TrustFrameworkPolicy
 xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
 xmlns:xsd="http://www.w3.org/2001/XMLSchema"
 xmlns="http://schemas.microsoft.com/online/cpim/schemas/2013/06"
 PolicySchemaVersion="0.3.0.0"
 TenantId="dbcab2c.onmicrosoft.com"
 PolicyId="B2C_1A_TrustFrameworkDevExtensions"
 PublicPolicyUri="http://dbcab2c.onmicrosoft.com/B2C_1A_TrustFrameworkDevExtensions">

    <BasePolicy>
        <TenantId>dbcab2c.onmicrosoft.com</TenantId>
        <PolicyId>B2C_1A_TrustFrameworkDevJourneys</PolicyId>
    </BasePolicy>

    <BuildingBlocks>

        <ClaimsSchema>
            <ClaimType Id="extension_totpRegisteredDev">
                <DisplayName>Totp registered</DisplayName>
                <DataType>boolean</DataType>
                <UserInputType>Readonly</UserInputType>
            </ClaimType>
        </ClaimsSchema>

        <ContentDefinitions>

            <!-- This content definition is to render an error page that displays unhandled errors. -->
            <ContentDefinition Id="api.error">
                <LoadUri>https://auth2-dev.dbca.wa.gov.au/sso/unified.html?title=Error</LoadUri>
            </ContentDefinition>

            <ContentDefinition Id="api.idpselections">
                <LoadUri>https://auth2-dev.dbca.wa.gov.au/sso/unified.html?title=Select%2520Identity%2520Provider</LoadUri>
            </ContentDefinition>

            <ContentDefinition Id="api.idpselections.signup">
                <LoadUri>https://auth2-dev.dbca.wa.gov.au/sso/unified.html?title=Select%2520Identity%2520Provider</LoadUri>
            </ContentDefinition>

            <ContentDefinition Id="api.signuporsignin">
                <LoadUri>https://auth2-dev.dbca.wa.gov.au/sso/unified.html?title=Select%2520Identity%2520Provider</LoadUri>
            </ContentDefinition>

            <ContentDefinition Id="api.selfasserted">
                <LoadUri>https://auth2-dev.dbca.wa.gov.au/sso/self_asserted.html?title=Please%2520fill%2520your%2520details</LoadUri>
            </ContentDefinition>

            <ContentDefinition Id="api.selfasserted.SignUpStep1-EmailVerify">
                <LoadUri>https://auth2-dev.dbca.wa.gov.au/sso/signup_verifyemail.html?title=Please%2520verify%2520your%2520email%26class=self_asserted_container</LoadUri>
                <RecoveryUri>~/common/default_page_error.html</RecoveryUri>
                <DataUri>urn:com:microsoft:aad:b2c:elements:contract:selfasserted:2.1.0</DataUri>
                <Metadata>
                    <Item Key="DisplayName">Collect information from user page</Item>
                </Metadata>
            </ContentDefinition>

            <ContentDefinition Id="api.selfasserted.SignUpStep2-UserProperties">
                <LoadUri>https://auth2-dev.dbca.wa.gov.au/sso/signup_userprofile.html??title=Please%2520fill%2520your%2520details%26class=self_asserted_container</LoadUri>
                <RecoveryUri>~/common/default_page_error.html</RecoveryUri>
                <DataUri>urn:com:microsoft:aad:b2c:elements:contract:selfasserted:2.1.0</DataUri>
                <Metadata>
                    <Item Key="DisplayName">Collect information from user page</Item>
                </Metadata>
            </ContentDefinition>

            <ContentDefinition Id="api.selfasserted.selectMfaMethod">
                <LoadUri>https://auth2-dev.dbca.wa.gov.au/sso/self_asserted.html?title=Select%2520multi-factor%2520authentication%2520method</LoadUri>
            </ContentDefinition>

            <ContentDefinition Id="api.selfasserted.profileupdate">
                <LoadUri>https://auth2-dev.dbca.wa.gov.au/sso/self_asserted.html?title=Update%2520your%2520profile</LoadUri>
            </ContentDefinition>

            <ContentDefinition Id="api.localaccountsignup">
                <LoadUri>https://auth2-dev.dbca.wa.gov.au/sso/self_asserted.html?title=Local%2520ccount%2520signup</LoadUri>
            </ContentDefinition>

            <ContentDefinition Id="api.localaccountpasswordreset.verifyemail">
                <LoadUri>https://auth2-dev.dbca.wa.gov.au/sso/self_asserted.html?title=Verify%2520your%2520email</LoadUri>
            </ContentDefinition>

            <ContentDefinition Id="api.localaccountpasswordreset">
                <LoadUri>https://auth2-dev.dbca.wa.gov.au/sso/self_asserted.html?title=Input%2520new%2520password</LoadUri>
            </ContentDefinition>

            <ContentDefinition Id="api.phonefactor">
                <LoadUri>https://auth2-dev.dbca.wa.gov.au/sso/self_asserted.html?title=Multi-factor%2520authentication%2520via%2520phone</LoadUri>
            </ContentDefinition>

            <ContentDefinition Id="api.selfasserted.totpfactor.registration">
                <LoadUri>https://auth2-dev.dbca.wa.gov.au/sso/totp_register.html?class=self_asserted_container</LoadUri>
            </ContentDefinition>

        </ContentDefinitions>
    </BuildingBlocks>

    <ClaimsProviders>

        <ClaimsProvider>
            <DisplayName>Azure Active Directory</DisplayName>
            <TechnicalProfiles>

                <TechnicalProfile Id="AAD-UserReadUsingAlternativeSecurityId-NoSession">
                    <OutputClaims>
                        <OutputClaim ClaimTypeReferenceId="totpRegistered" PartnerClaimType="extension_totpRegisteredDev" DefaultValue="false"/>
                    </OutputClaims>
                </TechnicalProfile>

                <TechnicalProfile Id="AAD-UserReadUsingEmailAddress">
                    <OutputClaims>
                        <OutputClaim ClaimTypeReferenceId="totpRegistered" PartnerClaimType="extension_totpRegisteredDev" DefaultValue="false"/>
                    </OutputClaims>
                </TechnicalProfile>

                <TechnicalProfile Id="AAD-UserReadUsingObjectId-NoSession">
                    <OutputClaims>
                        <OutputClaim ClaimTypeReferenceId="totpRegistered" PartnerClaimType="extension_totpRegisteredDev" DefaultValue="false"/>
                    </OutputClaims>
                </TechnicalProfile>

                <TechnicalProfile Id="AAD-WriteUserTOTPByObjectId-NoSession">
                    <PersistedClaims>
                        <PersistedClaim ClaimTypeReferenceId="extension_totpRegisteredDev" DefaultValue="true" AlwaysUseDefaultValue="true"/>
                    </PersistedClaims>
                </TechnicalProfile>

            </TechnicalProfiles>
        </ClaimsProvider>

        <ClaimsProvider>
            <DisplayName>Verify Email Sending Provider</DisplayName>
            <TechnicalProfiles>
                <TechnicalProfile Id="AUTH2-SendOtpViaEmail">
                    <Metadata>
                        <Item Key="ServiceUrl">https://auth2-dev.dbca.wa.gov.au/sso/verifycode</Item>
                    </Metadata>
                    <CryptographicKeys>
                        <Key Id="BearerAuthenticationToken" StorageReferenceId="B2C_1A_Auth2DevSecret"/>
                    </CryptographicKeys>
                </TechnicalProfile>

                <TechnicalProfile Id="AUTH2-SendOtpViaUserEmail">
                    <Metadata>
                        <Item Key="ServiceUrl">https://auth2-dev.dbca.wa.gov.au/sso/verifycode</Item>
                    </Metadata>
                    <CryptographicKeys>
                        <Key Id="BearerAuthenticationToken" StorageReferenceId="B2C_1A_Auth2DevSecret"/>
                    </CryptographicKeys>
                </TechnicalProfile>

                <TechnicalProfile Id="AUTH2-GenerateTOTPQRCode-NoSession">
                    <Metadata>
                        <Item Key="ServiceUrl">https://auth2-dev.dbca.wa.gov.au/sso/totp/generate</Item>
                    </Metadata>
                    <CryptographicKeys>
                        <Key Id="BearerAuthenticationToken" StorageReferenceId="B2C_1A_Auth2DevSecret"/>
                    </CryptographicKeys>
                </TechnicalProfile>

                <TechnicalProfile Id="AUTH2-VerifyTOTPCode">
                    <Metadata>
                        <Item Key="ServiceUrl">https://auth2-dev.dbca.wa.gov.au/sso/totp/verify</Item>
                    </Metadata>
                    <CryptographicKeys>
                        <Key Id="BearerAuthenticationToken" StorageReferenceId="B2C_1A_Auth2DevSecret"/>
                    </CryptographicKeys>
                </TechnicalProfile>

            </TechnicalProfiles>
        </ClaimsProvider>

            
        <ClaimsProvider>
            <DisplayName>Self Asserted</DisplayName>
            <TechnicalProfiles>
                <TechnicalProfile Id="SelfAsserted-SignUpStep1-EmailVerify">
                    <Metadata>
                        <Item Key="ContentDefinitionReferenceId">api.selfasserted.SignUpStep1-EmailVerify</Item>
                    </Metadata>
                </TechnicalProfile>
                    
                <TechnicalProfile Id="SelfAsserted-SignUpStep2-UserProperties">
                    <Metadata>
                        <Item Key="ContentDefinitionReferenceId">api.selfasserted.SignUpStep2-UserProperties</Item>
                    </Metadata>
                </TechnicalProfile>
            </TechnicalProfiles>
        </ClaimsProvider>


    </ClaimsProviders>

</TrustFrameworkPolicy>
